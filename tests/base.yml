---
- name: Verify
  hosts: all
  become: true
  tasks:
    - name: Check if SSH configuration file exists
      ansible.builtin.stat:
        path: /etc/ssh/sshd_config.d/custom.conf
      register: ssh_config_check

    - name: Assert that SSH configuration file was created
      ansible.builtin.assert:
        that:
          - ssh_config_check.stat.exists
        msg: "SSH configuration file does not exist."

    - name: Check if chronyd service is running
      ansible.builtin.systemd:
        name: chronyd
        state: started
      register: chronyd_service_check

    - name: Assert that chronyd service is running
      ansible.builtin.assert:
        that:
          - chronyd_service_check.status == "started"
        msg: "Chronyd service is not running."

    - name: Check if NTP servers are set in chrony.conf
      ansible.builtin.command: grep -E '^pool (ntp.nict.jp|ntp.jst.mfeed.ad.jp)' /etc/chrony.conf
      register: ntp_check

    - name: Assert that NTP servers are set in chrony.conf
      ansible.builtin.assert:
        that:
          - ntp_check.rc == 0
        msg: "NTP servers are not correctly set in chrony.conf."
